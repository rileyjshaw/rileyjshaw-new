<!DOCTYPE html><html class="blog-post-page" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.7b58fe7826c43cd66b29.css">:root{--white:#fff;--whitergb:255,255,255;--red:#ff4136;--green:#2ecc40;--blue:#0074d9;--cyan:#00bcd4;--magenta:#e91e63;--yellow:#ffdc00;--black:#0a0b08;--font-stack-sans:Arial,"Helvetica Neue",Helvetica,sans-serif;--font-stack-serif:Georgia,Palatino,"Palatino Linotype",Times,"Times New Roman",serif;--font-stack-heading:"Proxima Nova","Montserrat","Arial Black","Arial Bold",Gadget,sans-serif;--font-stack-mono:"Courier New",Courier,"Lucida Sans Typewriter","Lucida Typewriter",monospace;--font-scale--5:0.328em;--font-scale--4:0.41em;--font-scale--3:0.512em;--font-scale--2:0.64em;--font-scale--1:0.8em;--font-scale-0:1em;--font-scale-1:1.25em;--font-scale-2:1.563em;--font-scale-3:1.953em;--font-scale-4:2.441em;--font-scale-5:3.052em;font-family:var(--font-stack-sans);font-size:18px}*,:after,:before{box-sizing:border-box}body{color:var(--black);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;margin:0;min-height:100vh;text-rendering:optimizeLegibility}a{color:var(--blue)}a[target=_blank]{cursor:alias}a[target=_blank]:after{content:"\202F\279A";font-family:var(--font-stack-serif)}h1,h2,h3,h4,h5{font-family:var(--font-stack-heading)}h1{font-size:var(--font-scale-4);margin:var(--font-scale--1) 0 var(--font-scale--4)}h2{font-size:var(--font-scale-3);margin:var(--font-scale-0) 0 var(--font-scale--2)}h3,h4{font-size:var(--font-scale-1);margin:var(--font-scale-2) 0 var(--font-scale--1)}dd,dt,li,p{font-family:var(--font-stack-serif);line-height:1.5}dd,p{margin-bottom:var(--font-scale-1)}ul{list-style:disc}code,pre{font-family:var(--font-stack-mono);overflow:auto}pre{font-size:var(--font-scale--1)}[hidden]{display:none}button{cursor:pointer}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.idle-blocker,.idle-blocker button{background:var(--black);color:var(--white);font-family:var(--font-stack-serif)}.idle-blocker{align-items:center;display:flex;flex-direction:column;height:100vh;justify-content:center;left:0;position:fixed;top:0;width:100vw;z-index:10}.idle-blocker ul{display:flex;justify-content:space-between;list-style:none;padding:0}.idle-blocker button{border:0;font-size:inherit;margin:0 var(--font-scale-1);text-decoration:underline}.banner{align-items:center;background:var(--black);color:var(--white);display:flex;height:var(--font-scale-6);padding:0 1em;text-align:center;width:100%}.banner>*{flex-grow:1}.banner button{background:none;border:0;color:inherit;flex-grow:0;font-size:var(--font-scale-1);margin-left:auto}.site-nav{height:0;margin-bottom:-18px;margin-left:18px;padding-top:18px;position:-webkit-sticky;position:sticky;top:18px;z-index:1}.site-nav button{align-items:center;background:var(--white);border:none;border-radius:50%;box-shadow:0 1px 3px rgba(0,0,0,.12),0 1px 2px rgba(0,0,0,.24);color:var(--black);display:flex;font-size:var(--font-scale-2);height:54px;justify-content:center;padding:0;position:relative;-webkit-transition:box-shadow .3s cubic-bezier(.25,.8,.25,1);transition:box-shadow .3s cubic-bezier(.25,.8,.25,1);width:54px;z-index:1}.site-nav button:hover{box-shadow:0 3px 6px rgba(0,0,0,.16),0 3px 6px rgba(0,0,0,.23)}.site-nav button svg{fill:var(--black);height:50%}.site-nav ul{background:var(--white);bottom:0;flex-direction:column;left:0;list-style:none;margin:0;overflow:auto;-ms-scroll-chaining:none;overscroll-behavior:contain;padding:0;position:fixed;right:0;top:0}.site-nav ul:not([hidden]){display:flex}.site-nav li{border-radius:0 1000px 1000px 0;box-sizing:content-box}.site-nav a,.site-nav li{display:flex;flex-grow:1;width:100%}.site-nav a{align-items:center;-webkit-animation:fade-in 1s ease-in-out;animation:fade-in 1s ease-in-out;color:var(--black);font-family:var(--font-stack-sans);font-size:42px;justify-content:center;text-decoration:none}@-webkit-keyframes fade-in{0%{opacity:0;-webkit-transform:translate3d(-24px,0,0);transform:translate3d(-24px,0,0)}to{opacity:1;-webkit-transform:none;transform:none}}@keyframes fade-in{0%{opacity:0;-webkit-transform:translate3d(-24px,0,0);transform:translate3d(-24px,0,0)}to{opacity:1;-webkit-transform:none;transform:none}}.site-nav li:first-child a{-webkit-animation-delay:-.5s;animation-delay:-.5s}.site-nav li:nth-child(2) a{-webkit-animation-delay:-.4s;animation-delay:-.4s}.site-nav li:nth-child(3) a{-webkit-animation-delay:-.3s;animation-delay:-.3s}.site-nav li:nth-child(4) a{-webkit-animation-delay:-.2s;animation-delay:-.2s}.site-nav li:nth-child(5) a{-webkit-animation-delay:-.1s;animation-delay:-.1s}@media only screen and (max-width:800px){.site-nav{background:var(--white);height:36px;left:0;margin:0;padding:0;position:relative;top:0;width:100%}.site-nav button{border:none;border-radius:0;box-shadow:none!important;height:36px;-webkit-transition:none;transition:none;width:36px}.site-nav button.open{position:fixed}.site-nav button svg{height:80%}}.blog-post-page .site-nav,.page-not-found .site-nav{display:none}.content-node{background:var(--white);border:2px solid var(--black);box-shadow:3px 3px var(--black);color:var(--black);grid-row-end:span 4;max-width:100%;min-width:60px;padding:0 12px 16px;position:relative}.content-node.doodle{padding:0}.content-node.unmeasured{visibility:hidden}.content-node .content-type{align-items:center;background:var(--white);border:2px solid var(--black);color:var(--black);display:flex;font-family:var(--font-stack-heading);font-size:var(--font-scale--1);font-weight:900;height:24px;justify-content:center;left:-2px;padding:0 12px;position:absolute;top:-2px}.content-node h1{font-size:var(--font-scale-2);margin-bottom:8px;margin-top:var(--font-scale-1)}.content-node :not(h1)>a{position:relative}.content-node h1 a[target=_blank]:after{align-items:center;background:var(--white);border:2px solid var(--black);color:var(--black);content:"\279A";display:flex;font-size:24px;height:24px;justify-content:center;position:absolute;right:-2px;top:-2px;width:24px}.content-node time:before{content:"0"}.content-node .subheading{display:block;font-family:var(--font-stack-sans);font-size:var(--font-scale--2);font-style:italic;font-weight:700}.content-node .subheading a[target=_blank]:after{content:"\279A"}.content-node main{flex-basis:0;flex-grow:1;overflow:hidden}.content-node p{margin-bottom:0}.content-node.span-2{grid-column-end:span 2}.content-node.span-3{grid-column-end:span 3}.content-node.span-4{grid-column-end:span 4}.content-node.span-5{grid-column-end:span 5}.content-node.span-6{grid-column-end:span 6}.content-node footer{margin-top:auto}.content-node .tags{list-style:none;margin:0;padding:0}.content-node.measured .inner{display:flex;flex-direction:column;justify-content:flex-start;min-height:100%}.content-node .tags li{background:var(--black);border-radius:10px;color:var(--white);display:inline-block;font-size:var(--font-scale--2);height:20px;letter-spacing:2px;line-height:20px;margin-right:16px;margin-top:8px;padding:0 12px}.content-node.icon main{display:flex}.content-node.icon img{height:42px;margin:auto;width:42px}.excerpt section{position:relative}.excerpt section:after{background:-webkit-gradient(linear,left top,left bottom,from(rgba(var(--whitergb),0)),to(var(--white)));background:linear-gradient(rgba(var(--whitergb),0),var(--white));bottom:0;content:"";display:block;height:90px;left:0;pointer-events:none;position:absolute;right:0}.top-nav{margin-top:var(--font-scale-2)}.top-nav h1{display:inline;font:inherit;font-weight:700}.blog-post-page .site-content{font-size:var(--font-scale-1);margin:auto;max-width:90%;width:36em}.blog-post-content{padding-bottom:3em}.blog-post-content header{line-height:1}.blog-post-page .blog-post-content h1{font-family:var(--font-stack-heading);font-size:var(--font-scale-5);margin-bottom:0}.blog-post-content header .subheading{font-family:var(--font-stack-sans);font-size:var(--font-scale--2);font-style:italic;font-weight:700;margin-left:.2em}.blog-post-content ol,.blog-post-content ul{margin:var(--font-scale-1) 0}.blog-post-content li{margin-bottom:var(--font-scale--2)}.blog-post-content .footnote-ref{color:inherit;font-size:var(--font-scale--1);font-style:normal;font-weight:700;margin-left:.2em}.blog-post-content .footnotes li{margin-bottom:var(--font-scale--1)}.blog-post-content .footnotes p{display:inline}.blog-post-content figure{text-align:center}.blog-post-content img{max-width:100%}.blog-post-content figcaption{font-size:var(--font-scale--2);font-style:italic}.blog-post-content table{margin:1.5em 24px;text-align:left}.blog-post-content tr:nth-child(2n){background-color:#f8f8f8}.blog-post-content td,.blog-post-content th{border:1px solid #ddd;padding:6px 24px 6px 13px}.blog-post-content cite{display:block;text-align:right}.blog-post-content cite:before{content:"\2013   "}.blog-post-content hr{border:0;border-top:1px solid rgba(0,0,0,.3)}.blog-list-page-header{background:var(--cyan)}.blog-list{padding:30px}.blog-list .blog-posts{list-style:none;margin:0;padding:0}.blog-list .blog-post{margin-bottom:30px;padding-bottom:30px}.blog-list .blog-post h1{font-size:var(--font-scale-4);margin-top:var(--font-scale--2)}.blog-list .blog-post section{padding-top:1em}.blog-list .blog-post section>:first-child{margin-top:0}.blog-list .page-navigation{align-items:center;display:flex;font-size:var(--font-scale-2);justify-content:space-between;margin:auto;max-width:100%;padding:1.5em 0;width:12em}.blog-list .page-navigation a{font-weight:700;text-decoration:none}.blog-list .page-navigation .current-page{color:var(--yellow)}.page-not-found,.page-not-found #___gatsby,.page-not-found #gatsby-focus-wrapper,.page-not-found body{height:100%}.page-not-found #gatsby-focus-wrapper{background:var(--cyan);display:flex;flex-direction:column}.page-not-found header{background:var(--black);justify-self:flex-start}.page-not-found header:after{border-right-color:var(--cyan)}.page-not-found main{background:var(--white);border:1px solid var(--black);box-shadow:4px 4px var(--black);margin:60px auto 0;max-width:90%;padding:var(--font-scale-1) var(--font-scale-2);width:36em}@media only screen and (max-width:480px){.page-not-found #gatsby-focus-wrapper{background:var(--white)}.page-not-found header:after{border-right-color:var(--white)}.page-not-found main{border:0;box-shadow:none;margin:0;max-width:100%}}.big-quote{align-items:center;background:var(--black);color:var(--white);display:flex;flex-direction:column;font-family:var(--font-stack-serif);font-size:var(--font-scale-2);justify-content:space-between;margin:0;min-height:100vh;position:relative}.big-quote:before{content:"";margin-top:120px}.big-quote.no-refresh:after{content:"";margin-bottom:120px}.big-quote .refresh,.big-quote:after,.big-quote:before{height:60px;width:60px}.big-quote blockquote{margin:0 auto;max-width:800px;padding-bottom:2em;width:90%}.big-quote p{margin:0 0 30px;text-align:justify}.big-quote footer{text-align:right}.big-quote .refresh{background:none;border:0;fill:var(--white);margin-bottom:120px}@media only screen and (max-width:800px){.big-quote{font-size:var(--font-scale-0)}}.go-up{align-items:center;background:var(--yellow);display:flex;font-size:600px;height:100vh;justify-content:center;overflow:hidden;width:100%}.go-up span{color:var(--black);cursor:n-resize;-webkit-transform:translate(-10%) rotate(-90deg);transform:translate(-10%) rotate(-90deg)}@media only screen and (max-width:800px){.go-up{font-size:300px}}.about .page-header{background:var(--green)}.about-page-content{font-size:var(--font-scale-1);overflow:hidden}.about-page .about-me{margin:auto;max-width:90%;width:36em}.about-page .currently{color:var(--black)}.about-page .timeline{list-style:none;margin:0;padding:0}.about-page .timeline li{margin:0;position:relative}.about-page .timeline .logo{height:42px!important;width:42px!important}.about-page .timeline .job-title{font-size:var(--font-scale--2)}.content-node.doingreat-grid{background:var(--red);color:var(--green);font-weight:700;justify-items:stretch;text-align:center}.doingreat-item{align-items:center;display:flex;justify-content:center}.doingreat-item:nth-child(2n){background:var(--green);color:var(--blue)}.circles-item,.droplet-item,.snowman,.wavebump-item{align-items:center;display:flex;justify-content:center}.droplet-item,.wavebump-item{font-size:100px}.content-node.wavebump-item{background:var(--red);color:var(--yellow);grid-area:span 1/span 2}.content-node.wavebump-item.tall{background:var(--green);color:var(--yellow);grid-area:span 9/span 2}.content-node.droplet-item{background:var(--blue);color:var(--cyan);grid-area:span 1/span 2}.content-node.circles-grid{background:var(--blue);color:var(--magenta);font-size:60px;grid-area:span 2/span 3}.content-node.snowman{font-size:30px}.content-grid{align-items:stretch;display:grid;grid-auto-flow:row dense;grid-auto-rows:100px;grid-gap:30px;grid-template-columns:repeat(auto-fit,minmax(60px,-webkit-max-content));grid-template-columns:repeat(auto-fit,minmax(60px,max-content));justify-content:space-around;list-style:none;margin:0;padding:30px 0;width:100%}.project-explorer{min-height:100vh;padding:30px}.project-explorer .controls{align-items:flex-start;display:grid;grid-template-columns:[legends] auto [inputs] 1fr [cancel] auto}.project-explorer .filters fieldset{border:0;margin:0;padding:0}.project-explorer .filters fieldset fieldset{align-items:center;display:flex;flex-wrap:wrap;grid-column:1/-1;padding:0}.project-explorer .filters legend,.project-explorer .result-details{color:var(--white);font-family:var(--font-stack-heading);font-size:var(--font-scale-1);font-weight:900;grid-column:legends;line-height:47px}.project-explorer .filters legend{float:left}.project-explorer .warning{text-align:center}.project-explorer .warning a{color:var(--white)}.project-explorer .filters input{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.project-explorer-hide-filters,.project-explorer .filters button,.project-explorer .filters label{background:var(--cyan);border:2px solid var(--black);box-shadow:3px 3px var(--black);cursor:pointer;display:inline-block;font-family:var(--font-stack-heading);font-size:var(--font-scale--1);font-weight:900;margin:0 0 30px 16px;padding:10px 20px}.project-explorer-hide-filters{display:flex;margin-left:auto}.project-explorer .filters header button{margin:0 0 0 auto}.project-explorer .filters :checked+label,.project-explorer .filters button:active{border-color:var(--white);box-shadow:none;-webkit-transform:translate(3px,3px);transform:translate(3px,3px)}.explore{background:var(--blue)}.project-explorer-page-header{background:var(--cyan)}.project-explorer-page-header:after{border-right-color:var(--blue)!important}.page-header{position:relative}.cycle-bg{-webkit-animation:color-cycle 60s infinite;animation:color-cycle 60s infinite;background:var(--red)}@-webkit-keyframes color-cycle{0%{background:var(--red)}16.667%{background:var(--magenta)}33.333%{background:var(--blue)}50%{background:var(--cyan)}66.667%{background:var(--green)}83.333%{background:var(--yellow)}}@keyframes color-cycle{0%{background:var(--red)}16.667%{background:var(--magenta)}33.333%{background:var(--blue)}50%{background:var(--cyan)}66.667%{background:var(--green)}83.333%{background:var(--yellow)}}.page-header:after{border-right:100vw solid var(--white);border-top:3vw solid transparent;bottom:0;content:"";position:absolute;width:100%}.title{font-family:var(--font-stack-heading);font-size:var(--font-scale-5);font-weight:900;line-height:1;margin:0 0 0 10%;overflow:hidden;position:relative;text-transform:uppercase}.title .b,.title .g,.title .r{margin-top:30px;mix-blend-mode:screen;width:100%;will-change:left,top}.title .r{color:var(--red);left:-14px;position:relative}.title .r>:last-child{margin-bottom:-.1em}.title .b,.title .g,.title .shard{pointer-events:none;position:absolute;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.title .b,.title .g{left:7px}.title .g{color:var(--green);top:-12px}.title .b{color:var(--blue);top:12px}.title .shard{display:none}@supports (mix-blend-mode:screen){.title .shard{display:block;width:100%}}.main-content{background:var(--white);color:var(--black)}.main-content h2{font-size:var(--font-scale-3);margin-top:0}.main-about{background:var(--white)}.main-about h2{color:var(--black)!important}.section .row{display:block;margin:0 auto;max-width:100%;padding:80px 5%}.section .row>:first-child{color:var(--white);display:inline-block;font-family:var(--font-stack-heading);padding-right:10px;text-align:right;vertical-align:top;width:25%}.section .row>:first-child h2{margin-bottom:0}.section .row>:last-child{display:inline-block;font-family:var(--font-stack-serif);padding-left:100px;padding-top:12px;position:relative;text-align:left;top:-4px;width:70%}.about-stub{font-size:var(--font-scale-2)}.about-stub .md-wrapper,.about-stub p{display:inline}.main-projects{background:var(--blue)}.explore-link{color:var(--white)}h2+.explore-link{font-size:var(--font-scale-1)}.explore-more{color:var(--white);font-size:var(--font-scale-2)}@media only screen and (max-width:960px){.main-content .section .row>*{display:block;padding:0;text-align:left;width:100%}}.palette-test-tool ul{list-style:none;margin:0;padding:0}.palette-test-tool .title{border-bottom:1px solid var(--black);margin:1rem 18px 0;padding:0}.palette-test-tool .subtitle{color:var(--black);display:block;font-weight:700;margin:6px 18px 2rem;text-decoration:none}.list-name{align-items:center;background:var(--white);bottom:18px;display:inline-flex;height:2rem;margin:0 18px;padding:0 .2rem;position:-webkit-sticky;position:sticky;top:0;-webkit-transform:translateY(1rem);transform:translateY(1rem);z-index:1}.color-list{height:100vh;width:100vw}.color-item,.color-list{display:flex;position:relative}.color-item{align-items:center;flex-grow:1;justify-content:center}.color-item input{background:none;border:0;display:inline-block;font-size:42px;font-weight:700;max-width:12vw;text-align:center}.color-item svg{bottom:0;left:0;position:absolute;right:0;top:0}.multiply-test svg{mix-blend-mode:multiply}.screen-test svg{mix-blend-mode:screen}.fullscreen{border:12px solid #000;display:flex;font-size:60px;height:100vh;width:100vw}.fullscreen>*{margin:auto}.plus{height:110vh}.newsletter-form,.newsletter-form input{font-family:var(--font-stack-serif);font-weight:700}.newsletter-form{margin-bottom:var(--font-scale-3)}.newsletter-form label{display:block;font-size:var(--font-scale-1);margin-bottom:var(--font-scale--1)}.newsletter-form input{-webkit-appearance:none;-moz-appearance:none;appearance:none;border-radius:0;font-size:var(--font-scale--1);margin:0}.newsletter-form .bottom-row{display:flex;height:60px;margin:var(--font-scale--1) 0}.newsletter-form input[type=text]{border:1px solid var(--black);border-right:0;flex-grow:1;padding:4px 12px}.newsletter-form input[type=submit]{background:var(--black);border:0;color:var(--white);cursor:pointer;font-family:var(--font-stack-sans)}.subscribe-page-header{background:var(--magenta)}.subscribe-page .inner{font-size:var(--font-scale-1);margin:auto;max-width:90%;padding:60px 0;width:36em}.subscribe-page hr{margin:var(--font-scale-4) 0}</style><meta name="generator" content="Gatsby 2.18.17"/><title data-react-helmet="true">Stealing history with CSS binary trees · rileyjshaw</title><meta data-react-helmet="true" name="description" content="riley&#x27;s site"/><meta data-react-helmet="true" property="og:title" content="Stealing history with CSS binary trees"/><meta data-react-helmet="true" property="og:description" content="riley&#x27;s site"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@rileyjshaw"/><meta data-react-helmet="true" name="twitter:title" content="Stealing history with CSS binary trees"/><meta data-react-helmet="true" name="twitter:description" content="riley&#x27;s site"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#4ccbab"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" title="Highlights feed" href="/highlights.xml"/><link rel="alternate" type="application/rss+xml" title="Blog feed" href="/blog.xml"/><link rel="alternate" type="application/rss+xml" title="Projects feed" href="/explore.xml"/><link rel="alternate" type="application/rss+xml" title="Firehose feed" href="/index.xml"/><link as="script" rel="preload" href="/webpack-runtime-9ef2df1fc481965ccf48.js"/><link as="script" rel="preload" href="/styles-a5c12bb036341a0c3ece.js"/><link as="script" rel="preload" href="/commons-01e1df9b2e8b9c59f9f3.js"/><link as="script" rel="preload" href="/app-c7c6e111e468062febe8.js"/><link as="fetch" rel="preload" href="/page-data/blog/stealing-history-with-CSS-binary-trees/page-data.json" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#4ccbab"/><meta name="msapplication-TileColor" content="#4ccbab"/><meta name="theme-color" content="#4ccbab"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="banner"><p>This site is in beta.<!-- --> <a href="https://github.com/rileyjshaw/rileyjshaw-new/issues" target="_blank" rel="noopener noreferrer">Please report issues here</a>.</p><button>✖</button></div><nav class="site-nav"><button aria-expanded="false" aria-controls="menu" aria-haspopup="true" id="menubutton" class="closed"><svg viewBox="0 0 100 100"><path d="M86.1 58.5H13.9c-4.7 0-8.5-3.8-8.5-8.5s3.8-8.5 8.5-8.5h72.2c4.7 0 8.5 3.8 8.5 8.5s-3.8 8.5-8.5 8.5zM86.1 35H13.9c-4.7 0-8.5-3.8-8.5-8.5S9.2 18 13.9 18h72.2c4.7 0 8.5 3.8 8.5 8.5S90.8 35 86.1 35zM86.1 82.1H13.9c-4.7 0-8.5-3.8-8.5-8.5S9.2 65 13.9 65h72.2c4.7 0 8.5 3.8 8.5 8.5s-3.8 8.6-8.5 8.6z"></path></svg></button><ul aria-labelledby="menubutton" id="menu" role="menu" hidden=""><li><a href="/">Home</a></li><li><a href="/about">About</a></li><li><a href="/explore">Projects</a></li><li><a href="/blog">Blog</a></li><li><a href="/subscribe">Subscribe</a></li></ul></nav><div class="site-content"><header class="top-nav" role="banner"><nav role="navigation"><h1><a href="/">Riley Shaw</a></h1> <!-- -->/ <a href="/blog">Blog</a> / <!-- -->Stealing history with CSS binary trees</nav></header><main><article class="blog-post-content" role="article"><header><h1>Stealing history with CSS binary trees</h1><div class="subheading"><time>Posted <!-- -->November 12, 2014</time></div></header><div class="blog-post-markdown"><p><strong>UPDATE 2015-01-21</strong>: <em>Since writing this post, Chrome and FF have changed their alpha-blending functions. Demos likely won't work anymore. This is good news!!</em></p>
<p>History-sniffing attacks let front-end code peek at other sites you've visited. They can be used to target ads, steal information, or discern your identity. Creepy.</p>
<p>Historically, one of the most popular history-sniffing techniques was to style <code class="language-css">:visited</code> links using CSS and check their color with JavaScript. Major browsers started implementing <a href="https://hacks.mozilla.org/2010/03/privacy-related-changes-coming-to-css-vistited/" target="_blank" rel="noopener noreferrer">privacy changes</a> to address this attack in 2010.<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup> As a result, JavaScript's <code class="language-javascript">getComputedStyle</code> now returns unvisited styles for visited sites.</p>
<p>Even with these limitations there are a number of ways to scrape a user's history. The remainder of this article describes a combination of tricks used to do so. The outcome is a proof-of-concept <a href="/visited-vectors/reaction/">history-sniffing game</a>.</p>
<h2 id="trick-1-clicking-colors"><a href="#trick-1-clicking-colors" aria-label="trick 1 clicking colors permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Trick #1: Clicking colors</h2>
<p>Though <code class="language-javascript">getComputedStyle</code> is a dead-end, sniffers can trick <em>users</em> into telling a script which links they've visited. <a href="http://tinsnail.neocities.org/" target="_blank" rel="noopener noreferrer">This demo</a> is the clearest implementation that I've seen; the site shows a grid of styled links and asks you to click the red ones.</p>
<p>I saw the demo above while working on an unrelated game. The game asked players to hit the spacebar when a box turned red.</p>
<figure><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 241px;">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 254.35684647302907%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAzCAIAAAAYQr/UAAAACXBIWXMAAAsSAAALEgHS3X78AAADIklEQVRIx+1WS0/iUBTurzFuXPsDXLpybfwR7twYNyZGNyYmmrjQxbByY5TMIMlMJhqRQUqHCoQWEBgo0AdtbQu0FGiZD2sIMpjxMZOZhSdpc+6957vnce+55xD9fl/XNSpGdbvdGzrOC0JdruuGTpJky7KwqiqyrjeSiYQgiBj2XTcWi7VMEyyBz7IsURQdx7mhaUEUREk0zRYVI6V6HauKLBlGk2WY29uCJxwOX3lLA/Aoua47yowOhzQUJrDT8vIyTdPn5+c7OzuYOjg46HQ6gcAnv99fq9VWV1ez2ezFxUWlUtnc3EylUpDc2NjgeZ7QNG1mZub4+Hh/f39xcVEQhNnZ2Wg0urW1tbe3h63X19fhFHhMzs/Pn5ycHB4eTk1NJZNJAnHCHrquq6paLBabzSaG4FutFoYwRNN1hAM6XNcpFAq2bRuGIUkS9h33GXspigIGEsA0Go07Ve12e/V6XdeN0Sg8BMwbQxT/culHKBSCz1+/fC6VOZZlfB98snx3HbmWZHUskBM0F/L5dtvWNc00Tc9Ix3F5vqZN1PxqmgAeNWzsnH8PfpPmF4Dd1xJO522akV+4uuwLKZPJxONxIhKJ4GxxmM1nE65du91mGIZAlgyv1zPJOzMkGYHkeB2Y47h38Dv4HfzHwW/KZ9Q+cCgO7WcTShyU4fEavGG5XC7zQgJy8Ib9u0f/PwOP1sSJ9fEvaPaUoH1BWzM4UnPQ3xVLpbGeYAIYy71eDwzDMlehK1VRKmWu0TCy970flsbwT5rd63afcnUc7MmVy+VEIoFWKBgMojOTZblarWL+8vIS9Y2iqHQ6PWo/MWyC8N/d3Z2bm8ONn56eRhFcW1tbWVnBdktLSyijCwsL29vbnv2PwF5WoQP1+dB1yV62BO8J3eDR0RFCeHp6ig70keb7IDn4e8ofHP4lNt5qpwufOuBxEJ5mF6213//RtEyKjCZSab5WJanvHds+CwTyuTyE4PBZ8ExR1RgZ5bhKja9eR0lsMjC7kL8Nh785Tq/KcaIEq+U0y8KRVCJRKpUhYHds+oY2LSvDsoIgoTNOJlMw7SfBQ1mBif79rQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="Interface for a simple reaction game" title="Interface for a simple reaction game" src="/static/b5970e182bf26a4d74b659409d1f1283/87673/reaction1.png" srcset="/static/b5970e182bf26a4d74b659409d1f1283/70aa4/reaction1.png 169w,
/static/b5970e182bf26a4d74b659409d1f1283/87673/reaction1.png 241w" sizes="(max-width: 241px) 100vw, 241px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
    </span></figure>
<p><em>"Hey"</em>, I thought to myself, <em>"this game could be so much more sneaky!"</em></p>
<p>I swapped the box out for a stack of links and styled <code class="language-css">:visited</code> to <code class="language-css">background-color:red</code>. It was totally evil and awesome and ready to go!</p>
<figure><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 241px;">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 177.59336099585065%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAIAAAAGkY33AAAACXBIWXMAAAsTAAALEwEAmpwYAAACQElEQVRIx91TTW8SURQ909BNF03a9FdIWLJqYlyaEHXJhr/h2gXxH1ASE7sScQUhtrIwdQEUxBmtgQLF8lnAhq9p+SzJMG/wdqZMsDYytMZFX05u7rvzzjv3nfcG/s3NhNksWCxfF8E3iyVqsYBfXZ0AjOMoGoSixiGAL+vrlI2XlohvEDIpcVyP48Cvrd1OeUDK94PMyDxAVsFUyDOVBZQV48paqQx8BEJAHDgDjoEDWgPkgdSUdgNZ6+oN8AB4BTwDnqjxKfAIeAw8BMTp0a6TtVIUeAu8Bp4DL4CXwHcgprbzTiXMP/Noxh72x+HnuK2t0A3XPb+fL2wxsrCxQT8nW16emEwGoahxYDJhf2WFtpGmr9cIxqp491J5ezu7tZVxuxfFoduNyR0GlPF4clvcTfnfk5XfB2PsfykPh0Ox1ZKkMSWd8/NcLj+fTB1KkkRJvlD4sPu+3x8W84V+r3ucK1CRmh+TyUbalmWZMUV34G/K2mdRFOPxOOXhcLhWq41Go2KxSHWe509Pf1ar1Wg0egOZdCgGg0Gz2dxsNq1Wq9/vDwQCNpuNpna7vVKpOJ1Oh8OhK11XLpVKLper1WqFQiGaRiIRr9fb6XR8Ph+1QPoej0e/yCsyZaSszpVZ82YTckuv6PkleXRxEfscIz7PC+l0RjvFp729k2ote5RJJg8Hg8F+LEoSuzs7jWY7n8sdZX9ckRmT640GJelUqlw+0fZOJhKttlirVujalIlSb9SpLghCt9c/E8V2u03TXxVtAMQ+BxSBAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="Score displaying with red background" title="Score displaying with red background" src="/static/06e27a316663bc24564927d635022c84/87673/reaction2.png" srcset="/static/06e27a316663bc24564927d635022c84/70aa4/reaction2.png 169w,
/static/06e27a316663bc24564927d635022c84/87673/reaction2.png 241w" sizes="(max-width: 241px) 100vw, 241px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
    </span></figure>
<p>...almost.</p>
<figure><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 241px;">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 177.59336099585065%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAIAAAAGkY33AAAACXBIWXMAAAsTAAALEwEAmpwYAAACMUlEQVRIx91VXY/hYBT2e7h2KW4lYl268TdcuxD/wI249HVFZGdWQmYTn0UtgjK1LWa0O0HVaDESqt0z3klDdmbVzO7NnIvmnNP36XPe877nqS4ejzebzWq1+uMSq9VqxWJRh+O4oij7/V7RbLIsw3O9XusqlQp4u91ur9kkSQKIKIrvZ16tVp8EDA40TzqY2h41cwEzWqSJGaWGw2E6nc5kMqVSaT6f93q9er0Oa2iaJggCrXkFjKoKBoN6vd7v99vtdpvN9uVgZrPZYrGYTCae59UyT8AoBZcuHA4HAgGXy+V2u71eb6PRwDAslUpFo1EAnN/zZrNR26PuSGu30Qq14WrPP+cNuwwMGvJ+cKFQAG+73UqaDdoOeEEQnplJkuxebu12W6d8wHRvjY4m8IeY/z1YPrW3DvI/MMPfgOe47XYHzuLxkaLo82CoEG4LOHS//+3663K5HtD9pSj8pPrH03q+7MMwy2oH/saMXoNElctl8HO5HMuyoCeDwQDyMDwPD78YhgGRegWMRCeZTBoMhul0ajQa4debSCSsViuEDodjNBp5PB6n03ksySfMoLs+n4/juGw2C2E+n49EIovFIhaLQQnAHwqF1IN8ASO5OsTyn4qPnGMZVP1n8ObpCSthgMfxaqfTRbv4fnNzz7DkbbfVasPoFrAiUFxfXU2mM5qibsneCxi0cTyZgNMhiLu7e/TtVrPJzXiWGcGxyYo8nowhD/MriMs5z89mMwh/A+qs8lN/jfWbAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="Score displaying with white background" title="Score displaying with white background" src="/static/cc4d5fe240197dbd3c878ecdc8ceb629/87673/reaction3.png" srcset="/static/cc4d5fe240197dbd3c878ecdc8ceb629/70aa4/reaction3.png 169w,
/static/cc4d5fe240197dbd3c878ecdc8ceb629/87673/reaction3.png 241w" sizes="(max-width: 241px) 100vw, 241px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
    </span></figure>
<p>Since I didn't know when the square was red I was <em>always</em> displaying a score, even on misfires. I'd broken the game.</p>
<h2 id="trick-2-like-a-polar-bear-in-a-snowstorm"><a href="#trick-2-like-a-polar-bear-in-a-snowstorm" aria-label="trick 2 like a polar bear in a snowstorm permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Trick #2: Like a polar bear in a snowstorm</h2>
<p>Another popular history-sniffing trick is to hide non-<code class="language-css">:visited</code> links by making them appear the same color as the background. <a href="http://www.ieee-security.org/TC/SP2011/PAPERS/2011/paper010.pdf" target="_blank" rel="noopener noreferrer">This paper</a> shows some clever examples, as does <a href="http://lcamtuf.blogspot.ca/2013/05/some-harmless-old-fashioned-fun-with-css.html" target="_blank" rel="noopener noreferrer">this game</a>. By simply flipping this technique we can hide score text over the white non-<code class="language-css">:visited</code> links. For extra fanciness, we add a red text layer to indicate failure.</p>
<figure>
  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 675px;">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAA/ElEQVQY002PsU7DQBBEJz5bviLORTIICVEQikiIIh8B6ZJvck75o3wMRG5SusAJvuTOPsvGywYaVtPsat6MFkLKRyGWUXQLqDQ9H49EVG23BnBxbKW0AK987Oq6NMblud3t7OFgvQeEmAIvQSCBRClTluxzWn8DFIYURcQpWvdEfdPUbUvG0Mc7XS5sA8/zYvG6Xs/m86lSn0XhGc6ynuHVali+saXOMo50xjRNw8zwp2FALMSNlHfjcRIEqVLV/2alaJJcmzcbbu4YdY6Yt5bqmvoeEyGegNlo9ADcK/X1+7PR2gFtGPooaoGz1lzVeV8VRbvfe1ae+9PpB+R4rjT9xeQdAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="Text blending in with same-colored backgrounds" title="Text blending in with same-colored backgrounds" src="/static/e1da90272d4c56c4b3d5704a9f1e1eed/38c03/reaction4.png" srcset="/static/e1da90272d4c56c4b3d5704a9f1e1eed/70aa4/reaction4.png 169w,
/static/e1da90272d4c56c4b3d5704a9f1e1eed/17add/reaction4.png 338w,
/static/e1da90272d4c56c4b3d5704a9f1e1eed/38c03/reaction4.png 675w,
/static/e1da90272d4c56c4b3d5704a9f1e1eed/9c0e7/reaction4.png 964w" sizes="(max-width: 675px) 100vw, 675px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
    </span>
  <figcaption>White and red text are appropriately hidden on their respective backgrounds</figcaption>
</figure>
<p>With just the first two tricks we have a <a href="/visited-vectors/reaction/linear.html">functioning game</a>. Probing one link at a time covers ~60 links per minute and provides solid user insight. Tricks #3 and #4 improve our search algorithm,<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup> increasing read-speed by ~10x.</p>
<h2 id="trick-3-css-decoders"><a href="#trick-3-css-decoders" aria-label="trick 3 css decoders permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Trick #3: CSS decoders</h2>
<p><a href="http://lcamtuf.coredump.cx/css_calc/" target="_blank" rel="noopener noreferrer">This paper</a> builds an n-input OR gate in CSS using alpha-blending rounding errors. I've embedded my own cross-browser version below; click Result to see it in action:</p>
<div data-height="268" data-theme-id="5323" data-slug-hash="CjiKf" data-default-tab="css" data-user="rileyjshaw" class='codepen'><pre><code>$in: 0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0
<p>.container
div
opacity: 0.004
background: white</p>
<p>@for $b from 1 through length($in)
@if nth($in,$b) == 1
.l#{$b}
background: red</p>
<p>// Everything below this is beside the point...
.container
position: fixed
top: 50%
left: 50%
height: 120px
width: 120px
margin: -62px
border: 4px solid black
font: bold 32px/#{60px} sans-serif
text-align: center
color: red</p>
<p>div
position: absolute
top: 0
left: 0
height: 100%
width: 100%</p>
<p>p
position: relative</p>
<p>.on
color: white
</code></pre></p>
<p>See the Pen <a href='http://codepen.io/rileyjshaw/pen/CjiKf/'>n-input OR gate in CSS</a> by Riley Shaw (<a href='http://codepen.io/rileyjshaw'>@rileyjshaw</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
</div><script async src="https://assets.codepen.io/assets/embed/ei.js"></script>
<p>An OR gate is "on" if any of its inputs are "on". We can use this to probe n links<sup id="fnref-3"><a href="#fn-3" class="footnote-ref">3</a></sup> at once by stacking them together. Now if a user sees red and hits the spacebar we know that one of the links in the group has been visited.</p>
<h2 id="trick-4-slow-recursion"><a href="#trick-4-slow-recursion" aria-label="trick 4 slow recursion permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Trick #4: Slow recursion</h2>
<p>This trick figures out <em>which</em> of a group's links have been visited. We can divide each group into a binary tree for searching but can't rely on simple conditional search algorithms<sup id="fnref-4"><a href="#fn-4" class="footnote-ref">4</a></sup> since we're rate-limited by the user's reaction time.<sup id="fnref-5"><a href="#fn-5" class="footnote-ref">5</a></sup> This means that we must maintain state in our own stack.</p>
<p>If you're curious about specifics, <a href="https://github.com/rileyjshaw/visited-vectors/" target="_blank" rel="noopener noreferrer">the whole project is on GitHub</a>. Since the code's cluttered with game logic I've written a <a href="https://gist.github.com/rileyjshaw/02c5a8135dd3b1368918" target="_blank" rel="noopener noreferrer">stripped-down version of Trick #4</a>.</p>
<h2 id="trick-5-automation"><a href="#trick-5-automation" aria-label="trick 5 automation permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Trick #5: Automation</h2>
<p>Despite the gains achieved in Tricks #3 and #4, relying on user input will never be as fast as the old <code class="language-javascript">getComputedStyle</code> method.<sup id="fnref-6"><a href="#fn-6" class="footnote-ref">6</a></sup> Since we can no-longer automate color tests, is it possible to avoid looking at color altogether?<sup id="fnref-7"><a href="#fn-7" class="footnote-ref">7</a></sup> Testing 16 links requires alpha-blending 4,096 elements at each step.<sup id="fnref-8"><a href="#fn-8" class="footnote-ref">8</a></sup> This is a non-trivial operation; can we infer what the browser is drawing by testing render and redraw times?</p>
<p>This is a <a href="http://carlos.bueno.org/2011/10/timing.html" target="_blank" rel="noopener noreferrer">timing attack</a> and I'm not the first to apply it to this context. <a href="http://www.contextis.com/documents/2/Browser_Timing_Attacks.pdf" target="_blank" rel="noopener noreferrer">Pixel Perfect Timing Attacks with HTML5</a> is a <em>fantastic</em> white paper by Context Information Security on the subject. They were able to successfully implement timing attacks using CSS's <code class="language-css">text-shadow</code> property and SVG filters.<sup id="fnref-9"><a href="#fn-9" class="footnote-ref">9</a></sup> So, there's the answer. Now go read that paper.</p>
<h2 id="conclusion"><a href="#conclusion" aria-label="conclusion permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2>
<p>I won't be taking over the world with this project<sup id="fnref-10"><a href="#fn-10" class="footnote-ref">10</a></sup> but it demonstrates some interesting vectors. More security patches will be released, more creative hacks will arise; all it takes is a toehold and some creativity. Powerful new features make room for novel vulnerabilities. And so it goes.</p>
<p>Regarding browsing history, reaction games probably aren't your <a href="http://en.wikipedia.org/wiki/Global_surveillance_disclosures_(2013%E2%80%93present)" target="_blank" rel="noopener noreferrer">biggest concern</a> anyway. I'll just <a href="https://www.eff.org/" target="_blank" rel="noopener noreferrer">leave</a> <a href="https://www.torproject.org/" target="_blank" rel="noopener noreferrer">these</a> <a href="https://tails.boum.org/" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>And if you made it this far, just <a href="/visited-vectors/reaction/">play the damn game already</a>!</p>
<h2 id="references"><a href="#references" aria-label="references permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>References</h2>
<ul>
<li><a href="https://hacks.mozilla.org/2010/03/privacy-related-changes-coming-to-css-vistited/" target="_blank" rel="noopener noreferrer">Mozilla: privacy-related changes coming to CSS :visited</a></li>
<li><a href="http://tinsnail.neocities.org/" target="_blank" rel="noopener noreferrer">Who Am I</a></li>
<li><a href="http://www.ieee-security.org/TC/SP2011/PAPERS/2011/paper010.pdf" target="_blank" rel="noopener noreferrer">I still know what you visited last summer</a></li>
<li><a href="http://lcamtuf.blogspot.ca/2013/05/some-harmless-old-fashioned-fun-with-css.html" target="_blank" rel="noopener noreferrer">Defend your spaceship!</a></li>
<li><a href="http://saizai.livejournal.com/960791.html" target="_blank" rel="noopener noreferrer">getComputedStyle benchmark</a></li>
<li><a href="http://www.contextis.com/documents/2/Browser_Timing_Attacks.pdf" target="_blank" rel="noopener noreferrer">Pixel perfect timing attacks with HTML5</a></li>
<li><a href="http://seclists.org/fulldisclosure/2011/Dec/65" target="_blank" rel="noopener noreferrer">Fast and somewhat reliable cache timing</a></li>
<li><a href="http://arstechnica.com/security/2012/12/online-marketer-tapped-browser-flaw-to-see-if-visitors-were-pregnant/" target="_blank" rel="noopener noreferrer">History-sniffing in the news (2012)</a></li>
</ul>
<h2 id="footnotes"><a href="#footnotes" aria-label="footnotes permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Footnotes</h2>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1">
<p>A noble effort, but it's difficult to plug all the <a href="http://arstechnica.com/security/2014/06/theyre-ba-ack-browser-sniffing-ghosts-return-to-haunt-chrome-ie-firefox/" target="_blank" rel="noopener noreferrer">holes</a>.</p>
<a href="#fnref-1" class="footnote-backref">↩&#xFE0E;</a>
</li>
<li id="fn-2">
<p>True under the assumption that the dataset is sparsely populated with <code class="language-css">:visited</code> links. If there is a high percentage of <code class="language-css">:visited</code> links in the set you're actually better off with the linear algorithm. Good news: counting on a sparse dataset is a very safe bet.</p>
<a href="#fnref-2" class="footnote-backref">↩&#xFE0E;</a>
</li>
<li id="fn-3">
<p>I settled on n = 16 unique links per stack. Adding more links gives a performance hit, as it's not easy for the browser to composite that many layers (each unique link requires 256 elements). 16 seems to be a sweet-spot.</p>
<a href="#fnref-3" class="footnote-backref">↩&#xFE0E;</a>
</li>
<li id="fn-4">
<p>We can win the same O(logn) complexity with a small optimization: if spacebar is hit on level n and then <em>not</em> on the left branch of level n + 1, we can immediately skip to level n + 2 since we know that our result is on the right side. This works because we only need to check for existence.</p>
<a href="#fnref-4" class="footnote-backref">↩&#xFE0E;</a>
</li>
<li id="fn-5">
<p>Average human reaction time is just over 250ms, so we can safely budget 1s per frame-change.</p>
<a href="#fnref-5" class="footnote-backref">↩&#xFE0E;</a>
</li>
<li id="fn-6">
<p><code class="language-javascript">getComputedStyle</code> could process <a href="http://saizai.livejournal.com/960791.html" target="_blank" rel="noopener noreferrer">200k-3.4M URLs/min</a>. Our test is lucky to get 800 URLs/min.</p>
<a href="#fnref-6" class="footnote-backref">↩&#xFE0E;</a>
</li>
<li id="fn-7">
<p>Some history-sniffing attacks focus on entirely different vectors; a common example is to <a href="http://seclists.org/fulldisclosure/2011/Dec/65" target="_blank" rel="noopener noreferrer">request external resources and time the response</a>, probabilistically determining whether the result was cached. All current approaches that I've found (including the ones discussed above) are timing attacks.</p>
<a href="#fnref-7" class="footnote-backref">↩&#xFE0E;</a>
</li>
<li id="fn-8">
<p>I created a quick demo <a href="https://gist.github.com/rileyjshaw/abc13bd2d456669c7d5c" target="_blank" rel="noopener noreferrer">here</a> to inspect painting times in DevTools.</p>
<a href="#fnref-8" class="footnote-backref">↩&#xFE0E;</a>
</li>
<li id="fn-9">
<p>The coolest part of this paper is the second half; they implement OCR for cross-origin iframes using SVG filters. If you enjoyed my article at all (I assume you did since you made it this far) I <em>highly</em> recommend giving <a href="http://www.contextis.com/documents/2/Browser_Timing_Attacks.pdf" target="_blank" rel="noopener noreferrer">Pixel perfect timing attacks with HTML5</a> a read. It's at least 2 orders of magnitude cooler than my article.</p>
<a href="#fnref-9" class="footnote-backref">↩&#xFE0E;</a>
</li>
<li id="fn-10">
<p>...but just wait until you see the next one.</p>
<a href="#fnref-10" class="footnote-backref">↩&#xFE0E;</a>
</li>
</ol>
</div></div></article></main></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/stealing-history-with-CSS-binary-trees";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-c7c6e111e468062febe8.js"]};/*]]>*/</script><script src="/app-c7c6e111e468062febe8.js" async=""></script><script src="/commons-01e1df9b2e8b9c59f9f3.js" async=""></script><script src="/styles-a5c12bb036341a0c3ece.js" async=""></script><script src="/webpack-runtime-9ef2df1fc481965ccf48.js" async=""></script></body></html>