{"componentChunkName":"component---src-templates-post-js","path":"/blog/stealing-history-with-CSS-binary-trees","result":{"data":{"markdownRemark":{"html":"<p><strong>UPDATE 2015-01-21</strong>: <em>Since writing this post, Chrome and FF have changed their alpha-blending functions. Demos likely won't work anymore. This is good news!!</em></p>\n<p>History-sniffing attacks let front-end code peek at other sites you've visited. They can be used to target ads, steal information, or discern your identity. Creepy.</p>\n<p>Historically, one of the most popular history-sniffing techniques was to style <code class=\"language-css\">:visited</code> links using CSS and check their color with JavaScript. Major browsers started implementing <a href=\"https://hacks.mozilla.org/2010/03/privacy-related-changes-coming-to-css-vistited/\" target=\"_blank\" rel=\"noopener noreferrer\">privacy changes</a> to address this attack in 2010.<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup> As a result, JavaScript's <code class=\"language-javascript\">getComputedStyle</code> now returns unvisited styles for visited sites.</p>\n<p>Even with these limitations there are a number of ways to scrape a user's history. The remainder of this article describes a combination of tricks used to do so. The outcome is a proof-of-concept <a href=\"/visited-vectors/reaction/\">history-sniffing game</a>.</p>\n<h2 id=\"trick-1-clicking-colors\"><a href=\"#trick-1-clicking-colors\" aria-label=\"trick 1 clicking colors permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Trick #1: Clicking colors</h2>\n<p>Though <code class=\"language-javascript\">getComputedStyle</code> is a dead-end, sniffers can trick <em>users</em> into telling a script which links they've visited. <a href=\"http://tinsnail.neocities.org/\" target=\"_blank\" rel=\"noopener noreferrer\">This demo</a> is the clearest implementation that I've seen; the site shows a grid of styled links and asks you to click the red ones.</p>\n<p>I saw the demo above while working on an unrelated game. The game asked players to hit the spacebar when a box turned red.</p>\n<figure><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 241px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 254.35684647302907%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAzCAIAAAAYQr/UAAAACXBIWXMAAAsSAAALEgHS3X78AAADIklEQVRIx+1WS0/iUBTurzFuXPsDXLpybfwR7twYNyZGNyYmmrjQxbByY5TMIMlMJhqRQUqHCoQWEBgo0AdtbQu0FGiZD2sIMpjxMZOZhSdpc+6957vnce+55xD9fl/XNSpGdbvdGzrOC0JdruuGTpJky7KwqiqyrjeSiYQgiBj2XTcWi7VMEyyBz7IsURQdx7mhaUEUREk0zRYVI6V6HauKLBlGk2WY29uCJxwOX3lLA/Aoua47yowOhzQUJrDT8vIyTdPn5+c7OzuYOjg46HQ6gcAnv99fq9VWV1ez2ezFxUWlUtnc3EylUpDc2NjgeZ7QNG1mZub4+Hh/f39xcVEQhNnZ2Wg0urW1tbe3h63X19fhFHhMzs/Pn5ycHB4eTk1NJZNJAnHCHrquq6paLBabzSaG4FutFoYwRNN1hAM6XNcpFAq2bRuGIUkS9h33GXspigIGEsA0Go07Ve12e/V6XdeN0Sg8BMwbQxT/culHKBSCz1+/fC6VOZZlfB98snx3HbmWZHUskBM0F/L5dtvWNc00Tc9Ix3F5vqZN1PxqmgAeNWzsnH8PfpPmF4Dd1xJO522akV+4uuwLKZPJxONxIhKJ4GxxmM1nE65du91mGIZAlgyv1zPJOzMkGYHkeB2Y47h38Dv4HfzHwW/KZ9Q+cCgO7WcTShyU4fEavGG5XC7zQgJy8Ib9u0f/PwOP1sSJ9fEvaPaUoH1BWzM4UnPQ3xVLpbGeYAIYy71eDwzDMlehK1VRKmWu0TCy970flsbwT5rd63afcnUc7MmVy+VEIoFWKBgMojOTZblarWL+8vIS9Y2iqHQ6PWo/MWyC8N/d3Z2bm8ONn56eRhFcW1tbWVnBdktLSyijCwsL29vbnv2PwF5WoQP1+dB1yV62BO8J3eDR0RFCeHp6ig70keb7IDn4e8ofHP4lNt5qpwufOuBxEJ5mF6213//RtEyKjCZSab5WJanvHds+CwTyuTyE4PBZ8ExR1RgZ5bhKja9eR0lsMjC7kL8Nh785Tq/KcaIEq+U0y8KRVCJRKpUhYHds+oY2LSvDsoIgoTNOJlMw7SfBQ1mBif79rQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Interface for a simple reaction game\" title=\"Interface for a simple reaction game\" src=\"/static/b5970e182bf26a4d74b659409d1f1283/87673/reaction1.png\" srcset=\"/static/b5970e182bf26a4d74b659409d1f1283/70aa4/reaction1.png 169w,\n/static/b5970e182bf26a4d74b659409d1f1283/87673/reaction1.png 241w\" sizes=\"(max-width: 241px) 100vw, 241px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span></figure>\n<p><em>\"Hey\"</em>, I thought to myself, <em>\"this game could be so much more sneaky!\"</em></p>\n<p>I swapped the box out for a stack of links and styled <code class=\"language-css\">:visited</code> to <code class=\"language-css\">background-color:red</code>. It was totally evil and awesome and ready to go!</p>\n<figure><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 241px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 177.59336099585065%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAIAAAAGkY33AAAACXBIWXMAAAsTAAALEwEAmpwYAAACQElEQVRIx91TTW8SURQ909BNF03a9FdIWLJqYlyaEHXJhr/h2gXxH1ASE7sScQUhtrIwdQEUxBmtgQLF8lnAhq9p+SzJMG/wdqZMsDYytMZFX05u7rvzzjv3nfcG/s3NhNksWCxfF8E3iyVqsYBfXZ0AjOMoGoSixiGAL+vrlI2XlohvEDIpcVyP48Cvrd1OeUDK94PMyDxAVsFUyDOVBZQV48paqQx8BEJAHDgDjoEDWgPkgdSUdgNZ6+oN8AB4BTwDnqjxKfAIeAw8BMTp0a6TtVIUeAu8Bp4DL4CXwHcgprbzTiXMP/Noxh72x+HnuK2t0A3XPb+fL2wxsrCxQT8nW16emEwGoahxYDJhf2WFtpGmr9cIxqp491J5ezu7tZVxuxfFoduNyR0GlPF4clvcTfnfk5XfB2PsfykPh0Ox1ZKkMSWd8/NcLj+fTB1KkkRJvlD4sPu+3x8W84V+r3ucK1CRmh+TyUbalmWZMUV34G/K2mdRFOPxOOXhcLhWq41Go2KxSHWe509Pf1ar1Wg0egOZdCgGg0Gz2dxsNq1Wq9/vDwQCNpuNpna7vVKpOJ1Oh8OhK11XLpVKLper1WqFQiGaRiIRr9fb6XR8Ph+1QPoej0e/yCsyZaSszpVZ82YTckuv6PkleXRxEfscIz7PC+l0RjvFp729k2ote5RJJg8Hg8F+LEoSuzs7jWY7n8sdZX9ckRmT640GJelUqlw+0fZOJhKttlirVujalIlSb9SpLghCt9c/E8V2u03TXxVtAMQ+BxSBAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Score displaying with red background\" title=\"Score displaying with red background\" src=\"/static/06e27a316663bc24564927d635022c84/87673/reaction2.png\" srcset=\"/static/06e27a316663bc24564927d635022c84/70aa4/reaction2.png 169w,\n/static/06e27a316663bc24564927d635022c84/87673/reaction2.png 241w\" sizes=\"(max-width: 241px) 100vw, 241px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span></figure>\n<p>...almost.</p>\n<figure><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 241px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 177.59336099585065%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAIAAAAGkY33AAAACXBIWXMAAAsTAAALEwEAmpwYAAACMUlEQVRIx91VXY/hYBT2e7h2KW4lYl268TdcuxD/wI249HVFZGdWQmYTn0UtgjK1LWa0O0HVaDESqt0z3klDdmbVzO7NnIvmnNP36XPe877nqS4ejzebzWq1+uMSq9VqxWJRh+O4oij7/V7RbLIsw3O9XusqlQp4u91ur9kkSQKIKIrvZ16tVp8EDA40TzqY2h41cwEzWqSJGaWGw2E6nc5kMqVSaT6f93q9er0Oa2iaJggCrXkFjKoKBoN6vd7v99vtdpvN9uVgZrPZYrGYTCae59UyT8AoBZcuHA4HAgGXy+V2u71eb6PRwDAslUpFo1EAnN/zZrNR26PuSGu30Qq14WrPP+cNuwwMGvJ+cKFQAG+73UqaDdoOeEEQnplJkuxebu12W6d8wHRvjY4m8IeY/z1YPrW3DvI/MMPfgOe47XYHzuLxkaLo82CoEG4LOHS//+3663K5HtD9pSj8pPrH03q+7MMwy2oH/saMXoNElctl8HO5HMuyoCeDwQDyMDwPD78YhgGRegWMRCeZTBoMhul0ajQa4debSCSsViuEDodjNBp5PB6n03ksySfMoLs+n4/juGw2C2E+n49EIovFIhaLQQnAHwqF1IN8ASO5OsTyn4qPnGMZVP1n8ObpCSthgMfxaqfTRbv4fnNzz7DkbbfVasPoFrAiUFxfXU2mM5qibsneCxi0cTyZgNMhiLu7e/TtVrPJzXiWGcGxyYo8nowhD/MriMs5z89mMwh/A+qs8lN/jfWbAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Score displaying with white background\" title=\"Score displaying with white background\" src=\"/static/cc4d5fe240197dbd3c878ecdc8ceb629/87673/reaction3.png\" srcset=\"/static/cc4d5fe240197dbd3c878ecdc8ceb629/70aa4/reaction3.png 169w,\n/static/cc4d5fe240197dbd3c878ecdc8ceb629/87673/reaction3.png 241w\" sizes=\"(max-width: 241px) 100vw, 241px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span></figure>\n<p>Since I didn't know when the square was red I was <em>always</em> displaying a score, even on misfires. I'd broken the game.</p>\n<h2 id=\"trick-2-like-a-polar-bear-in-a-snowstorm\"><a href=\"#trick-2-like-a-polar-bear-in-a-snowstorm\" aria-label=\"trick 2 like a polar bear in a snowstorm permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Trick #2: Like a polar bear in a snowstorm</h2>\n<p>Another popular history-sniffing trick is to hide non-<code class=\"language-css\">:visited</code> links by making them appear the same color as the background. <a href=\"http://www.ieee-security.org/TC/SP2011/PAPERS/2011/paper010.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">This paper</a> shows some clever examples, as does <a href=\"http://lcamtuf.blogspot.ca/2013/05/some-harmless-old-fashioned-fun-with-css.html\" target=\"_blank\" rel=\"noopener noreferrer\">this game</a>. By simply flipping this technique we can hide score text over the white non-<code class=\"language-css\">:visited</code> links. For extra fanciness, we add a red text layer to indicate failure.</p>\n<figure>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 675px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAA/ElEQVQY002PsU7DQBBEJz5bviLORTIICVEQikiIIh8B6ZJvck75o3wMRG5SusAJvuTOPsvGywYaVtPsat6MFkLKRyGWUXQLqDQ9H49EVG23BnBxbKW0AK987Oq6NMblud3t7OFgvQeEmAIvQSCBRClTluxzWn8DFIYURcQpWvdEfdPUbUvG0Mc7XS5sA8/zYvG6Xs/m86lSn0XhGc6ynuHVali+saXOMo50xjRNw8zwp2FALMSNlHfjcRIEqVLV/2alaJJcmzcbbu4YdY6Yt5bqmvoeEyGegNlo9ADcK/X1+7PR2gFtGPooaoGz1lzVeV8VRbvfe1ae+9PpB+R4rjT9xeQdAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Text blending in with same-colored backgrounds\" title=\"Text blending in with same-colored backgrounds\" src=\"/static/e1da90272d4c56c4b3d5704a9f1e1eed/38c03/reaction4.png\" srcset=\"/static/e1da90272d4c56c4b3d5704a9f1e1eed/70aa4/reaction4.png 169w,\n/static/e1da90272d4c56c4b3d5704a9f1e1eed/17add/reaction4.png 338w,\n/static/e1da90272d4c56c4b3d5704a9f1e1eed/38c03/reaction4.png 675w,\n/static/e1da90272d4c56c4b3d5704a9f1e1eed/9c0e7/reaction4.png 964w\" sizes=\"(max-width: 675px) 100vw, 675px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption>White and red text are appropriately hidden on their respective backgrounds</figcaption>\n</figure>\n<p>With just the first two tricks we have a <a href=\"/visited-vectors/reaction/linear.html\">functioning game</a>. Probing one link at a time covers ~60 links per minute and provides solid user insight. Tricks #3 and #4 improve our search algorithm,<sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup> increasing read-speed by ~10x.</p>\n<h2 id=\"trick-3-css-decoders\"><a href=\"#trick-3-css-decoders\" aria-label=\"trick 3 css decoders permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Trick #3: CSS decoders</h2>\n<p><a href=\"http://lcamtuf.coredump.cx/css_calc/\" target=\"_blank\" rel=\"noopener noreferrer\">This paper</a> builds an n-input OR gate in CSS using alpha-blending rounding errors. I've embedded my own cross-browser version below; click Result to see it in action:</p>\n<div data-height=\"268\" data-theme-id=\"5323\" data-slug-hash=\"CjiKf\" data-default-tab=\"css\" data-user=\"rileyjshaw\" class='codepen'><pre><code>$in: 0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0\n<p>.container\ndiv\nopacity: 0.004\nbackground: white</p>\n<p>@for $b from 1 through length($in)\n@if nth($in,$b) == 1\n.l#{$b}\nbackground: red</p>\n<p>// Everything below this is beside the point...\n.container\nposition: fixed\ntop: 50%\nleft: 50%\nheight: 120px\nwidth: 120px\nmargin: -62px\nborder: 4px solid black\nfont: bold 32px/#{60px} sans-serif\ntext-align: center\ncolor: red</p>\n<p>div\nposition: absolute\ntop: 0\nleft: 0\nheight: 100%\nwidth: 100%</p>\n<p>p\nposition: relative</p>\n<p>.on\ncolor: white\n</code></pre></p>\n<p>See the Pen <a href='http://codepen.io/rileyjshaw/pen/CjiKf/'>n-input OR gate in CSS</a> by Riley Shaw (<a href='http://codepen.io/rileyjshaw'>@rileyjshaw</a>) on <a href='http://codepen.io'>CodePen</a>.</p>\n</div><script async src=\"https://assets.codepen.io/assets/embed/ei.js\"></script>\n<p>An OR gate is \"on\" if any of its inputs are \"on\". We can use this to probe n links<sup id=\"fnref-3\"><a href=\"#fn-3\" class=\"footnote-ref\">3</a></sup> at once by stacking them together. Now if a user sees red and hits the spacebar we know that one of the links in the group has been visited.</p>\n<h2 id=\"trick-4-slow-recursion\"><a href=\"#trick-4-slow-recursion\" aria-label=\"trick 4 slow recursion permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Trick #4: Slow recursion</h2>\n<p>This trick figures out <em>which</em> of a group's links have been visited. We can divide each group into a binary tree for searching but can't rely on simple conditional search algorithms<sup id=\"fnref-4\"><a href=\"#fn-4\" class=\"footnote-ref\">4</a></sup> since we're rate-limited by the user's reaction time.<sup id=\"fnref-5\"><a href=\"#fn-5\" class=\"footnote-ref\">5</a></sup> This means that we must maintain state in our own stack.</p>\n<p>If you're curious about specifics, <a href=\"https://github.com/rileyjshaw/visited-vectors/\" target=\"_blank\" rel=\"noopener noreferrer\">the whole project is on GitHub</a>. Since the code's cluttered with game logic I've written a <a href=\"https://gist.github.com/rileyjshaw/02c5a8135dd3b1368918\" target=\"_blank\" rel=\"noopener noreferrer\">stripped-down version of Trick #4</a>.</p>\n<h2 id=\"trick-5-automation\"><a href=\"#trick-5-automation\" aria-label=\"trick 5 automation permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Trick #5: Automation</h2>\n<p>Despite the gains achieved in Tricks #3 and #4, relying on user input will never be as fast as the old <code class=\"language-javascript\">getComputedStyle</code> method.<sup id=\"fnref-6\"><a href=\"#fn-6\" class=\"footnote-ref\">6</a></sup> Since we can no-longer automate color tests, is it possible to avoid looking at color altogether?<sup id=\"fnref-7\"><a href=\"#fn-7\" class=\"footnote-ref\">7</a></sup> Testing 16 links requires alpha-blending 4,096 elements at each step.<sup id=\"fnref-8\"><a href=\"#fn-8\" class=\"footnote-ref\">8</a></sup> This is a non-trivial operation; can we infer what the browser is drawing by testing render and redraw times?</p>\n<p>This is a <a href=\"http://carlos.bueno.org/2011/10/timing.html\" target=\"_blank\" rel=\"noopener noreferrer\">timing attack</a> and I'm not the first to apply it to this context. <a href=\"http://www.contextis.com/documents/2/Browser_Timing_Attacks.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">Pixel Perfect Timing Attacks with HTML5</a> is a <em>fantastic</em> white paper by Context Information Security on the subject. They were able to successfully implement timing attacks using CSS's <code class=\"language-css\">text-shadow</code> property and SVG filters.<sup id=\"fnref-9\"><a href=\"#fn-9\" class=\"footnote-ref\">9</a></sup> So, there's the answer. Now go read that paper.</p>\n<h2 id=\"conclusion\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>I won't be taking over the world with this project<sup id=\"fnref-10\"><a href=\"#fn-10\" class=\"footnote-ref\">10</a></sup> but it demonstrates some interesting vectors. More security patches will be released, more creative hacks will arise; all it takes is a toehold and some creativity. Powerful new features make room for novel vulnerabilities. And so it goes.</p>\n<p>Regarding browsing history, reaction games probably aren't your <a href=\"http://en.wikipedia.org/wiki/Global_surveillance_disclosures_(2013%E2%80%93present)\" target=\"_blank\" rel=\"noopener noreferrer\">biggest concern</a> anyway. I'll just <a href=\"https://www.eff.org/\" target=\"_blank\" rel=\"noopener noreferrer\">leave</a> <a href=\"https://www.torproject.org/\" target=\"_blank\" rel=\"noopener noreferrer\">these</a> <a href=\"https://tails.boum.org/\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>.</p>\n<p>And if you made it this far, just <a href=\"/visited-vectors/reaction/\">play the damn game already</a>!</p>\n<h2 id=\"references\"><a href=\"#references\" aria-label=\"references permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>References</h2>\n<ul>\n<li><a href=\"https://hacks.mozilla.org/2010/03/privacy-related-changes-coming-to-css-vistited/\" target=\"_blank\" rel=\"noopener noreferrer\">Mozilla: privacy-related changes coming to CSS :visited</a></li>\n<li><a href=\"http://tinsnail.neocities.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Who Am I</a></li>\n<li><a href=\"http://www.ieee-security.org/TC/SP2011/PAPERS/2011/paper010.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">I still know what you visited last summer</a></li>\n<li><a href=\"http://lcamtuf.blogspot.ca/2013/05/some-harmless-old-fashioned-fun-with-css.html\" target=\"_blank\" rel=\"noopener noreferrer\">Defend your spaceship!</a></li>\n<li><a href=\"http://saizai.livejournal.com/960791.html\" target=\"_blank\" rel=\"noopener noreferrer\">getComputedStyle benchmark</a></li>\n<li><a href=\"http://www.contextis.com/documents/2/Browser_Timing_Attacks.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">Pixel perfect timing attacks with HTML5</a></li>\n<li><a href=\"http://seclists.org/fulldisclosure/2011/Dec/65\" target=\"_blank\" rel=\"noopener noreferrer\">Fast and somewhat reliable cache timing</a></li>\n<li><a href=\"http://arstechnica.com/security/2012/12/online-marketer-tapped-browser-flaw-to-see-if-visitors-were-pregnant/\" target=\"_blank\" rel=\"noopener noreferrer\">History-sniffing in the news (2012)</a></li>\n</ul>\n<h2 id=\"footnotes\"><a href=\"#footnotes\" aria-label=\"footnotes permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Footnotes</h2>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">\n<p>A noble effort, but it's difficult to plug all the <a href=\"http://arstechnica.com/security/2014/06/theyre-ba-ack-browser-sniffing-ghosts-return-to-haunt-chrome-ie-firefox/\" target=\"_blank\" rel=\"noopener noreferrer\">holes</a>.</p>\n<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-2\">\n<p>True under the assumption that the dataset is sparsely populated with <code class=\"language-css\">:visited</code> links. If there is a high percentage of <code class=\"language-css\">:visited</code> links in the set you're actually better off with the linear algorithm. Good news: counting on a sparse dataset is a very safe bet.</p>\n<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-3\">\n<p>I settled on n = 16 unique links per stack. Adding more links gives a performance hit, as it's not easy for the browser to composite that many layers (each unique link requires 256 elements). 16 seems to be a sweet-spot.</p>\n<a href=\"#fnref-3\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-4\">\n<p>We can win the same O(logn) complexity with a small optimization: if spacebar is hit on level n and then <em>not</em> on the left branch of level n + 1, we can immediately skip to level n + 2 since we know that our result is on the right side. This works because we only need to check for existence.</p>\n<a href=\"#fnref-4\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-5\">\n<p>Average human reaction time is just over 250ms, so we can safely budget 1s per frame-change.</p>\n<a href=\"#fnref-5\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-6\">\n<p><code class=\"language-javascript\">getComputedStyle</code> could process <a href=\"http://saizai.livejournal.com/960791.html\" target=\"_blank\" rel=\"noopener noreferrer\">200k-3.4M URLs/min</a>. Our test is lucky to get 800 URLs/min.</p>\n<a href=\"#fnref-6\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-7\">\n<p>Some history-sniffing attacks focus on entirely different vectors; a common example is to <a href=\"http://seclists.org/fulldisclosure/2011/Dec/65\" target=\"_blank\" rel=\"noopener noreferrer\">request external resources and time the response</a>, probabilistically determining whether the result was cached. All current approaches that I've found (including the ones discussed above) are timing attacks.</p>\n<a href=\"#fnref-7\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-8\">\n<p>I created a quick demo <a href=\"https://gist.github.com/rileyjshaw/abc13bd2d456669c7d5c\" target=\"_blank\" rel=\"noopener noreferrer\">here</a> to inspect painting times in DevTools.</p>\n<a href=\"#fnref-8\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-9\">\n<p>The coolest part of this paper is the second half; they implement OCR for cross-origin iframes using SVG filters. If you enjoyed my article at all (I assume you did since you made it this far) I <em>highly</em> recommend giving <a href=\"http://www.contextis.com/documents/2/Browser_Timing_Attacks.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">Pixel perfect timing attacks with HTML5</a> a read. It's at least 2 orders of magnitude cooler than my article.</p>\n<a href=\"#fnref-9\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-10\">\n<p>...but just wait until you see the next one.</p>\n<a href=\"#fnref-10\" class=\"footnote-backref\">↩</a>\n</li>\n</ol>\n</div>","fields":{"date":"November 12, 2014","slug":"/blog/stealing-history-with-CSS-binary-trees","title":"Stealing history with CSS binary trees"}}},"pageContext":{}}}